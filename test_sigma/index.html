<html>
    <head>
        <style type="text/css">
        /* sigma.js context : */
        .sigma-parent {
            position: relative;
            border-radius: 4px;
            -moz-border-radius: 4px;
            -webkit-border-radius: 4px;
            background: #222;
            width: 100%;
            height: 100%;
        }
        .sigma-expand {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }
        .buttons-container{
            padding-bottom: 8px;
            padding-top: 12px;
        }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="sigma-parent" id="sigma-example-parent">
            <div class="sigma-expand" id="sigma-example"></div>
        </div>
        <script source="https://raw.githubusercontent.com/wesako/sigma.js/be50ec32d34e3d0bee4990b8341cb737e3b64d45/src/captors/sigma.captors.touch.js"></script>
        <script type="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/sigma.require.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/sigma.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.parsers.json.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.layout.forceAtlas2.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.parsers.gexf.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.renderers.customShapes.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.renderers.customEdgeShapes.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.renderers.edgeDots.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.renderers.edgeLabels.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.renderers.parallelEdges.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.renderers.snapshot.min.js"></script>
        <!--<script src="https://1.jsconsole.com/js/remote.js?6b88b258-ad4f-4189-8849-ddf51d204c66"></script>-->
        <script>

        // Add a method to the graph model that returns an
        // object with every neighbors of a node inside:
        sigma.classes.graph.addMethod('neighbors', function(nodeId) {
            var k,
            neighbors = {},
            index = this.outNeighborsIndex[nodeId] || {};
            for (k in index)

                neighbors[k] = this.nodesIndex[k];
            return neighbors;
        });

        var sigInst = new sigma({
            container: 'sigma-example',
            renderer: {
                //type: 'sigma.renderers.def',
                type: 'canvas',
                container: 'sigma-example-parent'
            },
            settings:{
                batchEdgesDrawing: false,
                canvasEdgesBatchSize: 25,
                webglEdgesBatchSize: 25, 
                hideEdgesOnMove: true,
                //scalingMode: 'inside',
                defaultLabelColor: '#fff',
                defaultLabelSize: 14,
                defaultLabelBGColor: '#fff',
                defaultLabelHoverColor: '#000',
                labelThreshold: 18,
                defaultEdgeType: 'arrow',
                minNodeSize: 1,
                maxNodeSize: 20,
                minEdgeSize: 0,
                maxEdgeSize: 5,
                defaultNodeColor: '#ff9999',
                autoRescale: false,

                //touchEnabled: true
            }
        });


        sigma.parsers.gexf('data/courses.gexf', sigInst, function() {
            console.log(sigInst.settings);
            //var my_captor = new captor_constructor(document.getElementById('sigma-example'), cameras[0], sigInst.settings);
            /*sigInst.startForceAtlas2();
            setTimeout(function() { sigInst.stopForceAtlas2(); }, 10000);
            //sigInst.graph.nodes().forEach(n => console.log(n.size));*/ 
            console.log(sigInst.cameras[0])
            sigInst.graph.nodes().forEach(function(n) {
                n.label = n.id;
                n.size = 20;
            });
            sigInst.graph.edges().forEach(function(e){
                e.size = 2;
                if(e.label == 'indicative'){
                    e.type = 'dashed';
                }
            });

            sigInst.bind('', function(e){
                console.log("coord");
            });

            saveColors(sigInst);
            highlight_neighbor(sigInst);
            sigInst.refresh();

        });
        //sigInst.startForceAtlas2();
        //setTimeout(function() { sigInst.stopForceAtlas2(); }, 15000);

        // save the original colors of our nodes and edges
        function saveColors(s){
            s.graph.nodes().forEach(function(n) {
                n.originalColor = n.color;
            });
            s.graph.edges().forEach(function(e) {
                e.originalColor = e.color;
            });

        }

        // Bind events for selection highlighting
        function highlight_neighbor(s) {       
            // When a node is clicked, highlight it and its neighbors
            s.bind('clickNode', function(e) {
                // get neighbors (nodes and edges)
                var nodeId = e.data.node.id,
                toKeep = s.graph.neighbors(nodeId);
                toKeep[nodeId] = e.data.node;

                // highlight nodes
                s.graph.nodes().forEach(function(node){
                    node.color = unselectedColor
                });
                s.graph.nodes().filter(function(node){return toKeep[node.id]}).forEach(function(node){
                    node.color = node.originalColor
                });

                // highliht edges
                s.graph.edges().filter(function(edge){return !toKeep[edge.id]}).forEach(function(edge){
                    edge.color = unselectedColor;
                    edge.size = 1;
                });
                s.graph.edges().filter(function(edge){return toKeep[edge.source] && toKeep[edge.target]}).forEach(function(edge){
                    edge.color = edge.originalColor;
                    edge.size = 5;
                });

                s.refresh(); // The data has been modified
            });

            // Undo selection
            s.bind('clickStage', function(e) {
                s.graph.nodes().forEach(function(node){
                    node.color = node.originalColor
                });
                s.graph.edges().forEach(function(edge){
                    edge.color = edge.originalColor;
                    edge.size = 2;
                });
                s.refresh();
            });
        }

        </script>

        <script>
            const unselectedColor = "rgba(102, 102, 102, 1)";
        </script>
    </body>
</html>